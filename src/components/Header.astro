---
import { Icon } from 'astro-icon/components';

const navItems = [
  { href: '#hero', label: 'Home' },
  { href: '#projects', label: 'Projects' },
  { href: '#skills', label: 'Skills' },
  { href: '#about', label: 'About' },
];
---

<header class="sticky top-0 z-50 bg-dark-400 border-b border-dark-300">
  <nav class="container mx-auto px-4 sm:px-6 lg:px-8 relative">
    <div class="flex items-center justify-between h-16">
      <a
        href="#hero"
        class="flex items-center gap-2 hover:opacity-80 transition-opacity">
        <img
          src="/images/logo.webp"
          alt="Portfolio Logo"
          class="fill-white h-16 w-auto"
        />
      </a>

      <button
        id="mobile-menu-button"
        class="md:hidden p-2 text-gray-300 hover:text-white"
        aria-label="Toggle menu"
        aria-expanded="false">
        <Icon name="mdi:menu" class="w-8 h-8 fill-current" />
      </button>

      <ul
        id="nav-menu"
        class="hidden md:flex items-center gap-8 flex-col md:flex-row absolute top-full left-0 right-0 bg-dark-400 border-b border-primary/30 shadow-2xl py-4 px-6 md:static md:bg-transparent md:shadow-none md:border-0 md:py-0 md:px-0">
        {
          navItems.map(item => (
            <li>
              <a
                href={item.href}
                class="nav-link block text-sm font-medium text-gray-300 hover:text-primary transition-colors cursor-pointer"
                data-section={item.href.slice(1)}>
                {item.label}
              </a>
            </li>
          ))
        }
      </ul>
    </div>
  </nav>
</header>

<script>
  const menuButton = document.getElementById('mobile-menu-button');
  const navMenu = document.getElementById('nav-menu');

  menuButton?.addEventListener('click', () => {
    const isHidden = navMenu?.classList.contains('hidden');
    navMenu?.classList.toggle('hidden');
    menuButton?.setAttribute('aria-expanded', String(!isHidden));
  });

  const navLinks = navMenu?.querySelectorAll('a');
  navLinks?.forEach(link => {
    link.addEventListener('click', () => {
      navMenu?.classList.add('hidden');
      menuButton?.setAttribute('aria-expanded', 'false');
    });
  });

  const sections = document.querySelectorAll('section[id]');
  const navLinksAll = document.querySelectorAll('.nav-link');

  const observerOptions = {
    root: null,
    rootMargin: '-20% 0px -60% 0px', // Trigger when section is in middle of viewport
    threshold: 0,
  };

  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        navLinksAll.forEach(link => {
          link.classList.remove('text-primary');
          link.classList.add('text-gray-300');
        });

        const activeLink = document.querySelector(
          `.nav-link[data-section="${entry.target.id}"]`
        );
        if (activeLink) {
          activeLink.classList.remove('text-gray-300');
          activeLink.classList.add('text-primary');
        }
      }
    });
  }, observerOptions);

  sections.forEach(section => observer.observe(section));

  if (window.scrollY < 100) {
    const firstLink = document.querySelector('.nav-link[data-section="hero"]');
    if (firstLink) {
      firstLink.classList.remove('text-gray-300');
      firstLink.classList.add('text-primary');
    }
  }
</script>
